<!doctype html public "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html lang=it>
<!-- $Id: uml-php.html,v 1.35 2009-02-09 09:43:40 doros Exp $ -->

<head>
  <title>Gestione della infrastruttura tecnologica - uml-php</title>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link rel="StyleSheet" href="my.css" type="text/css"  media="screen">
  <link rel="StyleSheet" href="myp.css" type="text/css" media="print">
</head>

<body>

<p> 
<a name="up"></a>
</p>

<h1 class="center">Laboratorio</h1>
<h2 class="center">Modulo 15 - Interattivit&agrave; sul Web</h2>

<p>
<table class=layout>
  <tr>
  <td class=content>
  <h3>Sperimentazione di un ambiente di sviluppo PHP virtuale</h3>
  </td>
  <td class=navigation>
    <a href="uml-Web.html"><img src="/icons/left.gif" alt="left" title="left"></a>
  </td>
  <td class=navigation>
    <a href="lab.html"><img src="/icons/up.gif" alt="up" title="up"></a>
  </td>
  <td class=navigation>
    <a href="uml-sockets.html"><img src="/icons/right.gif" alt="right" title="right"></a>
  </td>
  </tr>
</table>


<p>
Per la realizzazione di questo modulo useremo
<a href="lab.html" title="il laboratorio virtuale">Netkit4TIC</a>
<span class="yellow">con la
<a href="lab-setting.html#network" title="approfondimento">connettivit&agrave;</a>
con la rete reale (leggere il file <code>README</code>).</span>
</p>

<p>
L'ambiente virtuale pu&ograve; essere vantaggiosamente usato come
ambiente di sviluppo per applicazioni WEB mettendo a disposizione:
<ul>
  <li>
     una macchina personale con Apache, PHP e Mysql configurabili con i
     diritti di amministratore (<code>root</code>) per ogni sviluppatore</li>
  <li>
     la connettivit&agrave; con la macchina reale per utilizzare
     l'applicazione dal browser dello sviluppatore</li>
  <li>
     la raggiungibilit&agrave; con le macchine della rete reale
     per utilizzare l'applicazione dai browser delle macchine in rete
     o per raggiungere risorse presenti in Internet.</li>
</ul>

<p>
Inoltre l'utilizzo di questa modalit&agrave;
nella fase di test di una applicazione offre
maggire flessibilit&agrave; operativa.
</p>


<p>
L'esperienza che proponiamo si basa sulla costruzione del nodo
virtuale <code>www</code> con IP address 192.168.77.2
e con Apache/PHP e MySQL configurati e attivati (LAMP).
La root directory del server &egrave; <code>/var/www/php</code>.

Il
<a href="php.tgz"
   title="esperienza Netkit4TIC">tarball</a>
da scaricare deve essere
decompresso su una sottodirectory della <code>HOME</code>. In
seguito, dopo aver seguito le istruzioni presenti nel file
<code>README</code> occorre lanciare lo script:
</p>

<pre>
realHost$ lstart
realHost$ export GATE=192.168.77.2
realHost$ export BROWSER=x-www-browser
</pre>

<p>
se usassimo la sola interfaccia a caratteri basterebbe ridefinire:
</p>

<pre>
realHost$ export BROWSER=www-browser
</pre>


<p>
Iniziamo la sperimentazione di alcune funzionalit&agrave;:
</p>

<ul>
  <li> il primo programma: &quot;hello world&quot;
       (<a href="../lab/php/www/var/www/php/show.php?hello.php" title="sorgenti php">hello.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/hello.php
    </pre>
  </li>
  <li> visualizzazione delle informazioni sul PHP installato
       (<a href="../lab/php/www/var/www/php/show.php?info.php" title="sorgenti php">info.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/info.php
    </pre>
  </li>
  <li> esempio di intercalatura HTML/PHP
       (<a href="../lab/php/www/var/www/php/show.php?mix.php" title="sorgenti php">mix.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/mix.php
    </pre>
  </li>

  <li> uso di variabili predefinite
       (<a href="../lab/php/www/var/www/php/show.php?var.php" title="sorgenti php">var.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/var.php
    </pre>
  </li>
  <li> uso di singoli e doppi apici per definire stringhe
       (<a href="../lab/php/www/var/www/php/show.php?echo.php" title="sorgenti php">echo.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/var.php
    </pre>
  </li>
  <li> uso di array
       (<a href="../lab/php/www/var/www/php/show.php?array.php" title="sorgenti php">array.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/array.php
    </pre>
  </li>
  <li> uso di funzioni
       (<a href="../lab/php/www/var/www/php/show.php?functions.php" title="sorgenti php">functions.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/functions.php
    </pre>
  </li>
  <li> uso di oggetti
       (<a href="../lab/php/www/var/www/php/show.php?Classe.php" title="sorgenti php">Classe.php</a>,
        <a href="../lab/php/www/var/www/php/show.php?classe-test.php" title="sorgenti php">classe-test.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/classe-test.php
    </pre>
  </li>
  <li> uso di form HTML con azione in php
       (<a href="../lab/php/www/var/www/php/show.php?form.html" title="sorgenti html">form.html</a>,
        <a href="../lab/php/www/var/www/php/show.php?action.php" title="sorgenti php">action.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/form.html
    </pre>
  </li>
  <li> registrazione e cancellazione di un cookie
       (<a href="../lab/php/www/var/www/php/show.php?cookie.php" title="sorgenti php">cookie.php</a>,
        <a href="../lab/php/www/var/www/php/show.php?cancella.php" title="sorgenti php">cancella.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/cookie.php
    </pre>
   La cattura del traffico HTTP di set cookie
   <a href="../capture/php-setcookie.acp" title="file per Ethereal">(file ACP)</a>
   e di remove cookie
   <a href="../capture/php-delcookie.acp" title="file per Ethereal">(file ACP)</a> mette in evidenza come il browser, da quando riceve il cookie, lo
   include in ogni successivo invio verso il server. Infatti i cookies
   viaggiano con gli headers:
   <pre>
HTTP/1.1 200 OK
  Date: Thu, 07 Apr 2005 05:52:00 GMT
  Server: Apache/1.3.33 (Debian GNU/Linux) PHP/4.3.10-8
  X-Powered-By: PHP/4.3.10-8<span class="yellow">
  Set-Cookie: ultimavisita=1112853120</span>
  Keep-Alive: timeout=15, max=100
  Connection: Keep-Alive
  Transfer-Encoding: chunked
  Content-Type: text/html; charset=iso-8859-1
   </pre>
   Il browser memorizza il cookie e quindi possiamo chiederne la
   visualizzazione partendo dal menu
   <a href="php-cookie-ff-01.png"
      title="">Preference</a> e
   <a href="php-cookie-ff-02.png"
      title="">View Cookies</a>. &Egrave; interessante notare
   l'header <code>Keep-Alive</code> utilizzato per riutilizzare
   una stessa connessione per pi&ugrave; richieste. L'header
   <code>Transfer-Encoding</code> valorizzato a chunked
   permette che i contenuti su una connessione persistente
   avvengano in streaming invece che bufferizzati. Il
   <code>Content-Type</code> header indica l'utilizzo di formato
   <a href="http://en.wikipedia.org/wiki/MIME"
   title="Wikipedia">MIME</a>.
  </li>
  <li> registrazione di una sessione 
       (<a href="../lab/php/www/var/www/php/show.php?session.php" title="sorgenti php">session.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/session.php
    </pre>
   Il meccanismo sottostante alle sessioni sono i cookies: per prima
   cosa viene generato un numero casuale che rappresenta l'identificativo
   di sessione; per seconda cosa viene impostato un cookie nel browser con
   PHPSESSID='numero appena generato'.
   <pre>
HTTP/1.1 200 OK\r\n
  Date: Thu, 07 Apr 2005 09:32:26 GMT\r\n
  Server: Apache/1.3.33 (Debian GNU/Linux) PHP/4.3.10-8\r\n
  X-Powered-By: PHP/4.3.10-8\r\n<span class="yellow">
  Set-Cookie: PHPSESSID=16655b6e8f733c9f7ab56d621c8424e7; path=/\r\n
  Expires: Thu, 19 Nov 1981 08:52:00 GMT\r\n
  Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\r\n
  Pragma: no-cache\r\n</span>
  Keep-Alive: timeout=15, max=100\r\n
  Connection: Keep-Alive\r\n
  Transfer-Encoding: chunked\r\n
  Content-Type: text/html; charset=iso-8859-1\r\n
  \r\n
  HTTP chunked response
   </pre>
   Nel server
   il cookie viene salvato in un file <code>/tmp/sess_*</code>.
   <pre>
www# cat /tmp/sess_16655b6e8f733c9f7ab56d621c8424e7<span class="blue">
count|i:0;</span>
   </pre>
  Se vogliamo fissare la durata (lifetime) del cookie, ad esempio a 3600
  secondi, occorre impostare la variabile session.cookie_lifetime 
  come segue nel file <code>/etc/php5/apache2/php.ini</code>:
  <pre>
# /etc/php5/apache2/php.ini
[...]
; Lifetime in seconds of cookie or, if 0, until browser is restarted.
session.cookie_lifetime = 3600
[...]
</pre>
  </li>
  <li> uso di comandi MySQL
       (<a href="../lab/php/www/var/www/php/show.php?setup.sql" title="sorgenti sql">setup.sql</a>,
        <a href="../lab/php/www/var/www/php/show.php?database.php" title="sorgenti php">database.php</a>):
    <pre>
www# mysql mysql &lt; setup.sql
realHost$ ${BROWSER} http://${GATE}/database.php
    </pre>
    Nello script <code>setup.sql</code> vengono costruiti un database di
    nome <code>dbprova</code> e un utente di nome
    <code>luca</code> con privilegi di tipo
    SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, ALTER, INDEX quando
    si connette dalla rete e con privilegi massimi quando lavora
    da locale. Nella pagina <code>database.php</code> viene eseguito
    il comando SQL di creazione della tabella <code>rubrica</code>.
  </li>
  <li> ricerca dati SQL
       (<a href="../lab/php/www/var/www/php/show.php?populate.sql" title="sorgenti sql">populate.sql</a>,
        <a href="../lab/php/www/var/www/php/show.php?db_form.html" title="sorgenti html">db_form.html</a>,
        <a href="../lab/php/www/var/www/php/show.php?findit.php" title="sorgenti php">findit.php</a>):
    <pre>
www# mysql dbprova &lt; populate.sql
realHost$ ${BROWSER} http://${GATE}/db_form.html
    </pre>
    Nello script <code>populate.sql</code> vengono inseriti due
    record nella tabella <code>rubrica</code> in modo da rendere
    significativa la ricerca. La ricerca avviene con condizione OR
    sui campi <code>Nome</code> e <code>Cognome</code> in modo
    tale che se viene specificata la coppia (Tizio, Ermanno) la
    query restituisce due righe. La funzione php utilizzata per
    estrarre le righe &egrave; <code>mysql_fetch_array</code>.
  </li>
  <li>esempio di esecutore comandi SQL mediante l'uso
      di una form responsabile della generazione form, analisi
      dell'input, e nel caso di errori della ristampa della form
      con i messaggi di errore.
      In assenza di errori si redirige su un'altra pagina
      per la visualizzazione dell'esecuzione del comando SQL
       (<a href="../lab/php/www/var/www/php/show.php?getsql.php" title="sorgenti sql">getsql.php</a>,
        <a href="../lab/php/www/var/www/php/show.php?display.php" title="sorgenti php">display.php</a>):
    <pre>
www# mysql mysql &lt; setup.sql
www# mysql dbprova &lt; create.sql
www# mysql dbprova &lt; populate.sql
realHost$ ${BROWSER} http://${GATE}/getsql.php
    </pre>
    e proviamo a dare in input <code>select * from rubrica</code>.
   </li>
   <li>esempio di una classe wrapper responsabile per tutti gli accessi
       al database e di una classe di prova
       (<a href="../lab/php/www/var/www/php/show.php?SQL.php" title="sorgenti php">SQL.php</a>,
        <a href="../lab/php/www/var/www/php/show.php?sql-test.php" title="sorgenti php">sql-test.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/sql-test.php
    </pre>
   </li>
   <li>esempio di un pager che usa una classe Pager, la classe SQL dell'esempio
       precedente e un esempio di prova
       (<a href="../lab/php/www/var/www/php/show.php?Pager.php" title="sorgenti php">Pager.php</a>,
        <a href="../lab/php/www/var/www/php/show.php?SQL.php" title="sorgenti php">SQL.php</a>,
        <a href="../lab/php/www/var/www/php/show.php?pager-test.php" title="sorgenti php">pager-test.php</a>):
    <pre>
realHost$ ${BROWSER} http://${GATE}/pager-test.php?page=2
    </pre>
   </li>
</ul>

<p>
Per manipolare il contenuto del database
si pu{\o} usare un programma da installare
"lato client" come
MySQL Control Center (<code>mysqlcc</code>)
oppure il programma phpMyAdmin ad interfaccia WEB
installato "lato server".
</p>

<p>
Per usare il phpMyAdmin (user: root e passwd: vuota):
</p>

<pre>
realHost$ ${BROWSER} http://${GATE}/phpmyadmin
</pre>

<p>
Uno
<a href="php-admin.png" title="screenshot">screenshot</a> dopo aver
costruito la tabella rubrica nel database dbprova.
</p>

<p>
<table class=layout>
  <tr>
  <td class=content>
  <h3><a id=aw></a>Un esempio di Applicazione Web</h3>
  </td>
  <td class=navigation>
    <a href="#up"><img src="/icons/up.gif" alt="up" title="up"></a>
  </td>
  </tr>
</table>

<p>
Come riferimento principale usiamo il corso
<a href="http://matteo.vaccari.name/aw"
   title="link esterno">Applicazioni Web</a>
del prof. Matteo Vaccari il quale ha messo a disposizione parte del
codice usato nelle slide del suo corso.<br>
Il primo passo di un'applicazione &egrave; la form di login. Su
questo tema &egrave; utile seguire l'articolo di Jeff Cogswell
pubblicato su <code>ONLamp.com</code> dal titolo
"User-friendly Form Validation with PHP and CSS".
Con questi due maestri abbiamo il dovere di procedere correttamente.
</p>

<p>
Come consigliato nelle pagine del corso, la struttura delle directory
&egrave; la seguente:
</p>

<pre>
 (root)---------------------------| Makefile
 |                                | ChangeLog
 +----htdocs
 |         |
 |         +--admin
 |
 +----include
 |
 +----template
 |
 +----sql
 |
 +----config
</pre>

<p>
La radice &egrave; radicata nel filesystem del nodo virtuale in
<code>/var/www/php/aw</code> e quindi nel file
di configurazione di apache avremo la seguente linea:
</p>

<pre>
# /etc/apache2/sites-available/default
[...]
DocumentRoot /var/www/php/aw/htdocs/
[...]
</pre>

<p>
Copiamo quindi lo speciale file di configurazione di apache
in sostituzione di quello precedente e rifacciamo partire il server:
</p>

<pre>
www# cp /etc/apache2/sites-available/default-aw \
        /etc/apache2/sites-available/default
www# /etc/init.d/apache2 restart
</pre>

<p>
Costruiamo il database, creiamo le tabelle e le popoliamo:
</p>


<pre>
www# (cd /var/www/php/aw/sql ; \
             cat createdb.sql tables.sql populate.sql | mysql )
</pre>

<p>
Per testare il login puntiamo il browser su:
</p>

<pre>
realHost$ ${BROWSER} http://${GATE}/index.php
</pre>

<p>
e scopriremo che solo se ci autentichiamo come <code>nane</code>
o come <code>toni</code> (con password <code>not24get</code>)
riusciremo a vedere la pagina principale
</p>





<p>
<table class=layout>
<tr>
<td class=content>
</td>
<td class=navigation>
<a href="#up"><img src="/icons/up.gif" alt="up" title="up"></a>
</td>
</tr>
</table>




<address>
<!-- Creative Commons License -->
<a href="http://creativecommons.org/licenses/by-nc-sa/2.5/">
   <img alt="Creative Commons License"
        src="80x15.png"></a>
<span class="copyright">
Sandro Doro (sandro.doro @ istruzione.it)<br>
Ultima modifica: $Date: 2009-02-09 09:43:40 $
</span>
</address>


</body>

</html>
